---
date: "2019-08-05T14:07:44+02:00"
title: Template Walk-through
weight: 8
---



<div id="overview-of-this-page" class="section level2">
<h2>Overview of this page</h2>
<p>This page will demonstrate the steps to use the Acute Jaundice Syndrome (AJS) outbreak template, using data from an outbreak in Am Timan, Chad.</p>
<p><a href="https://rmarkdown.rstudio.com/articles_intro.html">Rmarkdown introduction</a> <a href="https://rmarkdown.rstudio.com/authoring_basics.html">Rmarkdown authoring basics</a></p>
</div>
<div id="header-and-introduction" class="section level2">
<h2>Header and introduction</h2>
<div class="figure">
<img src="/images/AJS_Intro.png" />

</div>
<p>The very top of the template consists of a header surrounded by <code>---</code>. Here you may want to edit the title of your document. The other settings in the header define the default document type produced (Microsoft Word) when the RMarkdown is “knit”.</p>
<p>The Introduction section is for your information and may be deleted before knitting the document.</p>
</div>
<div id="package-installation" class="section level2">
<h2>Package installation</h2>
<p>This section begins with text (with white background) which explains the purpose of the following code chunk. <strong>For your final report you may delete the text, but you must keep the code chunk!</strong> The code will run without producing any output in your report, but is required to load packages necessary to produce the report.</p>
<p>In the code chunk the commands do the following: 1) Sets default settings for the RMarkdown such as figure size, and handling of errors</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Sets the default way of displaying missing values in tables as “-”</p></li>
<li><p>Creates a vector of names of packages required for the template to run. Then each package is installed if it is not already installed, and each package is loaded for use in the current R session.</p></li>
<li><p>Default plot theme text size and epidemiological weeks are set to begin on Mondays.</p></li>
</ol>
</div>
<div id="reading-in-your-data" class="section level2">
<h2>Reading in your data</h2>
<p><strong>In this template section you choose the appropriate code chunk to importing your dataset.</strong></p>
<div class="figure">
<img src="/images/Data_Import.png" alt="Data Import" />
<p class="caption">Data Import</p>
</div>
<p>For this exercise our dataset is a <strong>non-standardized Excel file</strong> from MSF’s response an outbreak of AJS in Am Timan, Chad.</p>
</div>
<div id="aligning-the-dataset-with-the-data-dictionary" class="section level2">
<h2>Aligning the dataset with the data dictionary</h2>
<ol style="list-style-type: decimal">
<li>We can view the data dictionary for AJS using this command (also found in the template)</li>
</ol>
<pre class="r"><code># creates object linelist_dict using the msf_dict function from the sitrep package
# View the data dictionary with View() or by clicking the name in Environment (upper-right RStudio pane)
linelist_dict &lt;- msf_dict(&quot;AJS&quot;, compact = FALSE) %&gt;%
  select(option_code, option_name, everything())

View(linelist_dict)</code></pre>
<div class="figure">
<img src="/images/Data_Dictionary.png" alt="View of AJS data dictionary" />
<p class="caption">View of AJS data dictionary</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Now we make changes to our dataset to align it with the data dictionary. Following the template instructions, we uncomment lines of code to make a copy of the dataset, naming the copy “linelist_cleaned”.</li>
</ol>
<pre class="r"><code>## make a copy of your orginal dataset and name it linelist_cleaned
linelist_cleaned &lt;- linelist_raw</code></pre>
<p>Now we use the clean_labels function from the epitrix package to fix any variable names with non-standard syntax.</p>
<pre class="r"><code># define clean variable names using clean_labels from the epitrix package
# this function is preset rules for variable naming 
# for example it changes spaces and dots to &quot;_&quot; and characters to lowercase
cleaned_colnames &lt;- epitrix::clean_labels(colnames(linelist_raw))

# overwrite variable names with defined clean names
colnames(linelist_cleaned) &lt;- cleaned_colnames</code></pre>
<p><strong>Re-naming variables</strong><br />
Standardized variable names make this template work smoothly, and the variable names in our dataset do not align with the names this template expects. The template offers code that you can uncomment if you only have to change a few variable names (see below), but in our case we need to change many.</p>
<pre class="r"><code>## Renaming variables to match the template -------------------------------
## OPTIONAL: below is just an example in case you want to specifically change a
## few names you can also change specific var names using the *rename*
## function. In this example, we have the columns &quot;gender&quot; and &quot;age&quot; that we
## want to rename as &quot;sex&quot; and &quot;age_years&quot;.
## The formula for this is rename(data, NEW_NAME = OLD_NAME). 

# linelist_cleaned &lt;- rename(linelist_cleaned, 
#                            gender    = sex, # TEXT
#                            age_years = age  # INTEGER_POSITIVE
# )</code></pre>
<p>For our situation where we must re-name many variables, MSF developed a function that helps us map our variables to the expected variables.</p>
<p>-Run the command <code>msf_dict_rename_helper(&quot;AJS&quot;)</code> and a block of code text will be copied to your clipboard. You can run this command by entering it directly into the R terminal (lower-left RStudio pane), or highlighing it in the template and pressing Ctrl+Enter.</p>
<p>-Return to your template script and paste from your clipboard into the template. The code that is pasted will look like this:</p>
<pre class="r"><code>## Add the appropriate column names after the equals signs

linelist_cleaned &lt;- rename(linelist_cleaned,
#  event_file_type                   =   , # TEXT                # (Not in dataset)
  case_number                       =   hevid, # TEXT
  date_of_admission                 =   dtmedical, # DATE
  detected_by                       =   referredby, # TEXT
# patient_facility_type             =   , # TEXT                # (Not in dataset)
  msf_involvement                   =   , # TEXT                # (Not in dataset)
  age_years                         =   age, # INTEGER_POSITIVE
#  age_months                        =   , # INTEGER_POSITIVE   # (Dataset only has years)
#  age_days                          =   , # INTEGER_POSITIVE   # (Dataset only has years)
  sex                               =   sex, # TEXT
  patient_origin                    =   quartier, # ORG UNIT
#  residential_status_brief          =   , # TEXT               # (Not in dataset)
#  arrival_date_in_area_if_3m        =   , # DATE               # (Not in dataset)
#  ever_received_hepatitis_e_vaccine =   , # TEXT               # (Not in dataset)
#  date_of_last_vaccination          =   , # DATE               # (Not in dataset)
  date_of_onset                     =   dtjaundice, # DATE
#  history_of_fever                  =   , # BOOLEAN            # (Not in dataset)
  fever                             =   medfever, # BOOLEAN
  nausea_anorexia                   =   mednausea, # BOOLEAN
  vomiting                          =   medvomit, # BOOLEAN
  epigastric_pain_heartburn         =   medepigastric, # BOOLEAN
  generalized_itch                  =   meditching, # BOOLEAN
  headache                          =   medheadache, # BOOLEAN
  joint_pains                       =   medarthralgia, # BOOLEAN
  diarrhoea                         =   meddiar, # BOOLEAN
  bleeding                          =   medbleeding, # BOOLEAN
#  convulsions                       =   , # BOOLEAN            # (Not in dataset)
  mental_state                      =   medmental, # BOOLEAN    # !(Needs value cleaning)
  other_symptoms                    =   medother, # BOOLEAN
  other_cases_in_hh                 =   medothhhajs, # BOOLEAN
#  traditional_medicines             =   , # BOOLEAN            # (Not in dataset)
#  traditional_medicine_details      =   , # TEXT               # (Not in dataset)
#  recent_travel                     =   , # BOOLEAN            # (Not in dataset)
#  water_source                      =   , # TEXT               # !(Split across many variables)
  malaria_rdt_at_admission          =   medmalrdt, # TEXT
  hep_b_rdt                         =   medhepb, # TEXT
  hep_c_rdt                         =   medhepc, # TEXT
  hep_e_rdt                         =   medhevrdt, # TEXT
#  dengue_rdt                        =   , # TEXT               # (Not in dataset)
  date_lab_sample_taken             =   medblooddt, # DATE
  test_hepatitis_a                  =   medhavelisa, # TEXT
  test_hepatitis_b                  =   medhbvelisa, # TEXT
  test_hepatitis_c                  =   medhcvelisa, # TEXT
  test_hepatitis_e_virus            =   medhevelisa, # TEXT
  test_hepatitis_e_igm              =   hevrecent, # TEXT
#  test_hepatitis_e_igg              =   , # TEXT               # (In same variable as elisa result)
  test_hepatitis_e_genotype         =   hevgenotype, # TEXT
#  malaria_blood_film                =   , # TEXT               # (Not in dataset)
  dengue                            =   dengue, # TEXT
  yellow_fever                      =   yf, # TEXT
#  lassa_fever                       =   , # TEXT               # (Not in dataset)
#  typhoid                           =   , # TEXT               # (Not in dataset)
  chikungunya_onyongnyong           =   chik, # TEXT
#  ebola_marburg                     =   , # TEXT               # (Not in dataset)
  other_arthropod_transmitted_virus =   arbovpcr, # TEXT
#  other_pathogen                    =   , # TEXT               # (Not in dataset)
#  lab_comments                      =   , # TEXT               # (Not in dataset)
  pregnant                          =   medpreg, # TEXT
  trimester                         =   medpregtri, # TEXT
#  foetus_alive_at_admission         =   , # TEXT               # (Not in dataset)
#  delivery_event                    =   , # TRUE_ONLY          # (Not in dataset)
  pregnancy_outcome_at_exit         =   medppoutcome, # TEXT
  exit_status                       =   outcomehp, # TEXT
#  date_of_exit                      =   , # DATE               # (Not in dataset)
  time_to_death                     =   dtdeath, # TEXT
  treatment_facility_site           =   hpid, # TEXT
#  treatment_location                =   , # ORGANISATION_UNIT  # (Not in dataset)
  patient_origin_free_text          =    block # TEXT
)</code></pre>
<pre><code>## Error in is_symbol(expr): argument &quot;expr&quot; is missing, with no default</code></pre>
</div>
