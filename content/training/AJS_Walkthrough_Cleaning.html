---
date: "2019-08-05T14:07:44+02:00"
title: Template Walk-through
weight: 8
---



<div id="overview-of-this-page" class="section level2">
<h2>Overview of this page</h2>
<p>This page will demonstrate use of the Acute Jaundice Syndrome (AJS) outbreak template using data from an outbreak in Am Timan, Chad. This first page covers the initial data importation and cleaning steps in the template.</p>
<p><strong>Opening the correct template</strong> [instructions here on opening the correct template]</p>
<p><strong>Access the dataset for this walk-through</strong> [instructions and link to dataset here]</p>
<p><strong>RMarkdown resources</strong><br />
Review the page “Reading a RMarkdown Script”, or reference these resources: <a href="https://rmarkdown.rstudio.com/articles_intro.html">Rmarkdown introduction</a> and <a href="https://rmarkdown.rstudio.com/authoring_basics.html">Rmarkdown authoring basics</a>.</p>
<div id="ajshev-outbreak-in-am-timan-chad-2016-2017" class="section level3">
<h3>AJS/HEV outbreak in Am Timan, Chad (2016-2017)</h3>
<p>We will be using data and examples from a real outbreak of Hepatitis E virus (HEV) infection which occurred in the Chadian town of Am Timan between October 2016 and April 2017</p>
<p><img src="/images/AJS_Article.png" alt="AJS Article snip", width = "40%"></p>
<p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0188240">Link to publication</a></p>
<p><em>DISCLAIMER: The real data from the outbreak has been used for the training materials linked to the outbreak templates of the R4epis project. The Chadian Ministry of Health (MoH) has approved the use of this data for training purposes. Please note, that some data has been adapted in order to best achieve training objectives. Also, the GPS coordinates included in the dataset do not correspond to real cases identified during this outbreak. They have been generated exclusively for training purposes.</em></p>
<p>In early September 2016, a cluster of severely ill pregnant women with jaundice was detected at the Am Timan Hospital in the maternity ward. Following rapid tests conducted in Am Timan and confirmatory testing in the Netherlands, this was confirmed as due to HEV infection. Thus the MoH and MSF outbreak response was activated. The response consisted of four components: 1) active community based surveillance (CBS), 2) clinical assessment and management of ill cases at the hospital, 3) water chlorination activities at most water points in the town, 4) hygiene promotion.</p>
<p>The outbreak linelist data was combined data from the active CBS data and the clinical data from the hospital. The CBS functioned with community health workers visiting all households in the town every two weeks and actively searching for people with Acute Jaundice Syndrome (AJS). For this group of persons (suspected cases), only those that were visibly ill or that were pregnant were referred to the hospital for clinical assessment and admission if required. Persons that self-reported to the hospital or that arrived after referral would undergo a clinical assessment and a rapid test for HEV for diagnosis. Thus only for people assessed at the hospital were we able to capture a confirmed case status.</p>
<p>For the duration of the outbreak we detected 1193 suspected cases, 100 confirmed cases and discarded 150 cases with AJS who were not positive for HEV infection.</p>
</div>
</div>
<div id="template-header-and-introduction" class="section level2">
<h2>Template header and introduction</h2>
<p>The very top of the template consists of a header surrounded by <code>---</code> lines. Here you may want to edit the title of your document. The other settings in the header define the default document type produced (Microsoft Word) when the RMarkdown is “knit”.</p>
<p>The “Introduction to this template” section is for your information only and this text can be deleted before knitting the document.</p>
<p><img src="/images/AJS_Intro.png" alt="AJS Header and Introduction snip", width = "75%"></p>
</div>
<div id="package-installation" class="section level2">
<h2>Package installation</h2>
<p>This section begins with text which explains the purpose of the following code chunk. <strong>For your final report you may delete the text, but you must keep this code chunk!</strong> The code will run without producing any output in your report, but is required to load packages necessary to produce the report.</p>
<p>The code chunk does the following:</p>
<ul>
<li><p>Set default settings for the RMarkdown such as figure size, and handling of errors</p></li>
<li><p>Set the default way of displaying missing values in tables as “-”</p></li>
<li><p>Create a vector of names of packages required for the template to run. Then each package is installed if it is not already installed, and each package is loaded for use in the current R session.</p></li>
<li><p>Set default plot theme text size and epidemiological weeks are set to begin on Mondays.</p></li>
</ul>
</div>
<div id="importing-the-dataset" class="section level2">
<h2>Importing the dataset</h2>
<p><strong>In this template section you choose the appropriate code chunk to importing your dataset.</strong></p>
<p><img src="/images/AJS_Data_Import.png" alt="Data import options snip", width = "75%"></p>
<p>For this exercise our dataset is a <strong>non-standardized Excel file</strong> from MSF’s response an outbreak of AJS in Am Timan, Chad, so we use the <code>read_nonDHIS_data</code> code chunk, specifically the line that uses the import() function of the rio package to import an Excel file that is not password protected.</p>
</div>
<div id="aligning-the-dataset-with-the-data-dictionary" class="section level2">
<h2>Aligning the dataset with the data dictionary</h2>
<p>When using a non-standardized dataset, the variable names and values must be aligned with the data dictionary. This can take some time and requires looking back-and-forth between your dataset, RStudio, and the MSF data dictionary. In this example, here are the steps taken:</p>
<div id="review-the-msf-data-dictionary" class="section level3">
<h3>Review the MSF data dictionary</h3>
<p>Use this command (found in the template) to view the MSF data dictionary for the disease (“AJS” in this example)</p>
<pre class="r"><code># creates object linelist_dict using the msf_dict function from the sitrep package
linelist_dict &lt;- msf_dict(&quot;AJS&quot;, compact = FALSE) %&gt;%
  select(option_code, option_name, everything())</code></pre>
<p>You can view the data dictionary by running the command <code>View(linelist_dict)</code>, or by clicking the name linelist_dict in the RStudio Environment (upper-right RStudio pane)</p>
<div class="figure">
<img src="/images/AJS_Data_Dictionary.png" />

</div>
</div>
<div id="clean-variable-names" class="section level3">
<h3>Clean variable names</h3>
<p>Uncomment the appropriate lines of code to make a copy of the dataset, naming the copy “linelist_cleaned”.</p>
<pre class="r"><code>## make a copy of your orginal dataset and name it linelist_cleaned
linelist_cleaned &lt;- linelist_raw</code></pre>
<p>Use the clean_labels function from the epitrix package to fix any variable names with non-standard syntax.</p>
<pre class="r"><code># this function is preset rules for variable naming 
# for example it changes spaces and dots to &quot;_&quot; and characters to lowercase
cleaned_colnames &lt;- epitrix::clean_labels(colnames(linelist_raw))

# overwrite variable names with defined clean names
colnames(linelist_cleaned) &lt;- cleaned_colnames</code></pre>
</div>
<div id="re-name-variables-to-align-with-data-dictionary" class="section level3">
<h3>Re-name variables to align with data dictionary</h3>
<p>Standardized variable names are required for this template to work smoothly, and the variable names in our dataset do not align with the names this template expects. The template offers code that you can uncomment if you only have to change a few variable names (see below). <strong>However, in this example we need to change many variable names. MSF developed a special function to help map our variables to the expected variables.</strong></p>
<ul>
<li><strong>Paste the disease-specific rename helper into the script.</strong> This command is found in the template. For our example we run the command <code>msf_dict_rename_helper(&quot;AJS&quot;)</code> and a block of code text is copied to the clipboard. Return to the template script and paste from the clipboard into the template. For the AJS template, the code that is pasted will look like the code below. This code uses the function rename() to change variable names.</li>
</ul>
<p><img src="/images/AJS_Rename_Variables_Empty.png" alt="rename variables empty snip", width = "75%"></p>
<ul>
<li><strong>Complete the mapping of variable names.</strong> To the right of the equals sign, and before the comma, type the <em>exact</em> names of the variables from your dataset that correspond to the expected MSF data dictionary variables on the left. <em>If there is a data dictionary variable that is not present in your dataset, be sure to comment (#) out that line, as shown in the GIF below.</em></li>
</ul>
<div class="figure">
<img src="/images/AJS_Variable_Names.gif" />

</div>
<p><strong>Tip: </strong>If you see this error:<br />
<code>Error in is_symbol(expr) : argument &quot;expr&quot; is missing, with no default</code><br />
then you likely forgot to comment (#) the line for a variable you did not use.</p>
<p>And now you can see the result:</p>
<p><img src="/images/AJS_Rename_Variables_Proof.png" alt="rename variables proof", width = "85%"></p>
</div>
</div>
<div id="provide-population-counts" class="section level2">
<h2>Provide population counts</h2>
<p>In order to calculate attack and mortality rates by region and age groups, the population counts for these categories are collected. If you choose not to complete this section, please delete or comment (#) the default gen_population() code and expect that later sections on attack and mortality rates will give errors instead of output.</p>
<p><strong>The template allows several ways to provide population figures so that they are stored in data frames with specific variable names.</strong> Of course, the specific age groupings and region names in your data frames may differ from the examples.</p>
<p>You can do one of the following:<br />
1) Enter the counts directly <strong>[need clarification here as this is not yet built]</strong><br />
2) Use the function gen_population() to derive the counts from proportions<br />
3) Import a spreadsheet file with the counts in the correct format</p>
<div class="figure">
<img src="/images/AJS_Population_Counts.png" />

</div>
</div>
<div id="lab-data" class="section level2">
<h2>Lab data</h2>
<p>[Paragraph about lab data here - how it is used]</p>
</div>
<div id="creating-and-cleaning-variables" class="section level2">
<h2>Creating and cleaning variables</h2>
<p>The variables and values in our example AJS dataset are still very far from the standard AJS MSF data dictionary. In the data cleaning step we will need to do the following:</p>
<ol style="list-style-type: decimal">
<li><strong>Re-code missing values from periods (.) to <code>NA</code> at import</strong></li>
</ol>
<p>Currently, missing values in the dataset are represented by a period (.). This causes problems because R expects missing values to be coded as <code>NA</code>. For example, if we attempt to set the variable date_of_onset to class Date, R gives an error because the periods are considered character values and do not fit the expected YYYY-MM-DD date format.</p>
<p>To fix this problem we scroll up to the import section of the template and insert an additional argument in the import command. The argument <code>na = &quot;.&quot;</code> specifies a period as the value in the Excel sheet that R will consider to be “missing”. As the data are imported, all cells with that value are changed to <code>NA</code>.</p>
<pre class="r"><code># The old import command
linelist_raw &lt;- rio::import(&quot;AJS_AmTiman.xlsx&quot;, which = &quot;linelist&quot;)

# The revised import command (don&#39;t forget the comma between arguments!)
linelist_raw &lt;- rio::import(&quot;AJS_AmTiman.xlsx&quot;, which = &quot;linelist&quot;, na = &quot;.&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>**</li>
</ol>
</div>
