---
date: "2019-08-21T10:38:36+02:00"
title: Person analyses
weight: 12
---



<div id="person" class="section level2">
<h2>Person</h2>
<p>TODO [general description of person section]</p>
<div id="demographic-tables" class="section level3">
<h3>Demographic Tables:</h3>
<p>The first demographic table presents patients by their age group (the table’s rows) and their relationship with the case definition (the table’s columns). Arguments row_total and col_total are set to TRUE, resulting in totals shown for rows and columns.</p>
<ul>
<li>The select() command removed an unnecessary column “variable” generated by tab_linelist().<br />
</li>
<li>The rename() command renames the column “value” with “Age Group”<br />
</li>
<li>The rename_redundant() command replaces any column name that has proportion with “%”<br />
</li>
<li>The augment_redundant() command replaces any column name with n with &quot; cases (n)&quot;<br />
</li>
<li>The kable() command completes the table with two digits after a decimal</li>
</ul>
<p><strong>TODO: There seems to still be issues with the new tab_linelist function. Error says object proportion is unknown. Need to resolve and then remove the # from the rename_redundant line below.</strong></p>
<pre class="r"><code># use if you have lab results in your data
# get counts and props of age groups by case definition 
# include column and row totals 
tab_linelist(linelist_cleaned, 
             age_group, strata = case_def, 
             col_total = TRUE, row_total = TRUE) %&gt;%
  select(-variable) %&gt;%
  rename(&quot;Age group&quot; = value) %&gt;%
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; cases (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 2)</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 8 missing values</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">Suspected cases (n)</th>
<th align="right">%</th>
<th align="right">Missing cases (n)</th>
<th align="right">%</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">45</td>
<td align="right">5.57</td>
<td align="right">23</td>
<td align="right">3.65</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">320</td>
<td align="right">39.60</td>
<td align="right">321</td>
<td align="right">50.87</td>
<td align="right">641</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">296</td>
<td align="right">36.63</td>
<td align="right">181</td>
<td align="right">28.68</td>
<td align="right">477</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">113</td>
<td align="right">13.99</td>
<td align="right">76</td>
<td align="right">12.04</td>
<td align="right">189</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">34</td>
<td align="right">4.21</td>
<td align="right">30</td>
<td align="right">4.75</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">808</td>
<td align="right">100.00</td>
<td align="right">631</td>
<td align="right">100.00</td>
<td align="right">1439</td>
</tr>
</tbody>
</table>
<p>As demonstrated in the subsequent template code, you can change the argument strata = to refer to any number of variables including sex. You can also choose to include or edit the in-line code that gives a count of the missing cases by sex and age_group.</p>
<p>To show proportions of the total population, use the following code, with the argument prop_total specified as TRUE.</p>
<pre class="r"><code>tab_linelist(linelist_cleaned, 
             age_group, strata = sex,
             col_total = TRUE, row_total = TRUE, prop_total = TRUE) %&gt;% 
  select(-variable) %&gt;%
  rename(&quot;Age group&quot; = value) %&gt;%
#  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; cases (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 2)</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 8 missing values</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">F cases (n)</th>
<th align="right">F proportion</th>
<th align="right">M cases (n)</th>
<th align="right">M proportion</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">26</td>
<td align="right">1.81</td>
<td align="right">42</td>
<td align="right">2.92</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">223</td>
<td align="right">15.50</td>
<td align="right">418</td>
<td align="right">29.05</td>
<td align="right">641</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">317</td>
<td align="right">22.03</td>
<td align="right">160</td>
<td align="right">11.12</td>
<td align="right">477</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">118</td>
<td align="right">8.20</td>
<td align="right">71</td>
<td align="right">4.93</td>
<td align="right">189</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">32</td>
<td align="right">2.22</td>
<td align="right">32</td>
<td align="right">2.22</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">716</td>
<td align="right">49.76</td>
<td align="right">723</td>
<td align="right">50.24</td>
<td align="right">1439</td>
</tr>
</tbody>
</table>
</div>
<div id="age-pyramid" class="section level3">
<h3>Age pyramid</h3>
<p>To print an age pyramid in your report, use the code below. A few things to note:</p>
<ul>
<li>The <strong>variable for split_by should have two non-missing value options</strong> (e.g. Male or Female, Oui or Non, etc.)<br />
</li>
<li>The variable names work with or without quotation marks<br />
</li>
<li>The dashed lines in the bars are the midpoint of the un-stratified age group<br />
</li>
<li>You can adjust the position of the legend by replacing legend.position = “bottom” with “top”, “left”, or “right”<br />
</li>
<li>Read more by searching plot_age_pyramid in the Help tab of the lower-right RStudio pane</li>
</ul>
<p>You can make this a pyramid of months by supplying age_group_mon to the age_group argument.</p>
<pre class="r"><code># plot age pyramid 
 
plot_age_pyramid(linelist_cleaned, 
                 age_group = &quot;age_group_mon&quot;, 
                 split_by = &quot;sex&quot;) + 
  labs(y = &quot;Cases (n)&quot;, x = &quot;Age group&quot;) + # change axis  labels (nb. x/y flip)
  theme(legend.position = &quot;bottom&quot;,     # move legend to bottom
        legend.title = element_blank(), # remove title
        text = element_text(size = 18)  # change text size
       )</code></pre>
<p><img src="/training/Walk-through/person_analyses_files/figure-html/age_pyramid-1.png" width="720" /></p>
<pre class="r"><code># get counts and proportions for all variables named in SYMPTOMS
tab_linelist(linelist_cleaned, SYMPTOMS, keep = &quot;Yes&quot;) %&gt;% 
  select(-value) %&gt;%
  # fix the way symptom names are displayed
  mutate(variable = str_to_sentence(gsub(&quot;_&quot;, &quot; &quot;, variable))) %&gt;%
  # rename accordingly
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 2)</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 644 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 641 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 649 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 644 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 642 missing values

## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 642 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 647 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 649 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 645 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 691 missing values</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 1387 missing values</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">n</th>
<th align="right">%</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<pre class="r"><code># get counts and proportions for all variables named in LABS
multi_descriptive(linelist_cleaned, LABS, .id = &quot;Lab test&quot;) %&gt;% 
  # re-order columns (drop total_prop too)
  select(&quot;Lab test&quot;, Pos_n, Positive_prop, Neg_n, Negative_prop, 
         &quot;Not done_n&quot;, &quot;Not done_prop&quot;, Total_n) %&gt;% 
  # rename accordingly
  rename(&quot;Unknown (n)&quot; = &quot;Not done_n&quot;) %&gt;%
  rename_redundant(&quot;prop&quot; = &quot;%&quot;) %&gt;%
  augment_redundant(&quot;_n$&quot; = &quot; (n)&quot;) %&gt;%
  kable(digits = 2)</code></pre>
<pre><code>## Error in .f(.x[[i]], ...): object &#39;Positive_prop&#39; not found</code></pre>
</div>
</div>
<div id="cfr-section" class="section level2">
<h2>CFR Section</h2>
<p>Time to death not applicable.</p>
<p>The case fatality ratio among inpatients with known outcomes is below.</p>
<p>Case Fatality Ratio - note that this requires there to be a variable patient_facilit_type, the value “Inpatient”, and the DIED variable created earlier.</p>
<pre class="r"><code># use arguments from above to produce overal CFR
overall_cfr &lt;- linelist_cleaned %&gt;% 
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  case_fatality_rate_df(deaths = DIED, mergeCI = TRUE) %&gt;%
  rename(&quot;Deaths&quot; = deaths,
         &quot;Cases&quot; = population,
         &quot;CFR (%)&quot; = cfr,
         &quot;95%CI&quot; = ci)

  knitr::kable(overall_cfr, digits = 2)         # print nicely with 2 digits</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.12</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>We can also do CFR by sex</p>
<pre class="r"><code>linelist_cleaned %&gt;%
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  mutate(sex = forcats::fct_explicit_na(sex, &quot;-&quot;)) %&gt;%
  case_fatality_rate_df(deaths = DIED, group = sex, mergeCI = TRUE, add_total = TRUE) %&gt;%
  rename(&quot;Sex&quot; = sex, 
         &quot;Deaths&quot; = deaths, 
         &quot;Cases&quot; = population, 
         &quot;CFR (%)&quot; = cfr, 
         &quot;95%CI&quot; = ci) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Sex</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="right">11</td>
<td align="right">55</td>
<td align="right">20.00</td>
<td align="left">(11.55–32.36)</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="right">2</td>
<td align="right">31</td>
<td align="right">6.45</td>
<td align="left">(1.79–20.72)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.12</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>…and by age_group:</p>
<p>CFR by age group among inpatients with known outcomes</p>
<pre class="r"><code>linelist_cleaned %&gt;%
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  case_fatality_rate_df(deaths = DIED, group = age_group, mergeCI = TRUE, add_total = TRUE) %&gt;%
  tidyr::complete(age_group, 
                  fill = list(deaths = 0, population = 0, cfr = 0, ci = 0)) %&gt;% # Ensure all levels are represented
  rename(&quot;Age Group&quot; = age_group, 
         &quot;Deaths&quot; = deaths, 
         &quot;Cases&quot; = population, 
         &quot;CFR (%)&quot; = cfr, 
         &quot;95%CI&quot; = ci) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age Group</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">4</td>
<td align="right">11</td>
<td align="right">36.36</td>
<td align="left">(15.17–64.62)</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">1</td>
<td align="right">17</td>
<td align="right">5.88</td>
<td align="left">(1.05–26.98)</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">13.89</td>
<td align="left">(6.08–28.66)</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">11.76</td>
<td align="left">(3.29–34.34)</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">25.00</td>
<td align="left">(4.56–69.94)</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.12</td>
<td align="left">(9.05–24.16)</td>
</tr>
<tr class="odd">
<td align="left">-</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="left">(0.00–79.35)</td>
</tr>
</tbody>
</table>
<p>CFR by case definition (not enough to do)</p>
<pre class="r"><code># Use if you have enough confirmed cases for comparative analysis 
#
 linelist_cleaned %&gt;%
   filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
   case_fatality_rate_df(deaths = DIED, group = case_def, mergeCI = TRUE, add_total = TRUE) %&gt;%
   rename(&quot;Case Definition&quot; = case_def, 
          &quot;Deaths&quot; = deaths, 
          &quot;Cases&quot; = population, 
          &quot;CFR (%)&quot; = cfr, 
          &quot;95%CI&quot; = ci) %&gt;% 
   knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Case Definition</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Suspected</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.12</td>
<td align="left">(9.05–24.16)</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.12</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
</div>
<div id="attack-rate" class="section level2">
<h2>Attack Rate</h2>
<p>To use the attack rate section, we need to modify the first code slightly. An object “population” is created from the sum of population counts in the population figures. Because we only imported region-based population counts, we must change this command to reflect that we do not have population_data_age, but rather population_data_region</p>
<pre class="r"><code># OLD define population 
# population &lt;- sum(population_data_age$population)</code></pre>
<p>Running the correct command and printing the value of population, we see that the sum population across regions is estimated to be 62336.</p>
<pre class="r"><code># Correct command for this exercise
population &lt;- sum(population_data_region$population)

population</code></pre>
<pre><code>## [1] 62336</code></pre>
<p>Below gives the attack rate per 10,000 population (N = 62,336)</p>
<pre class="r"><code># calculate the ar
# store as AR to be able to use output for automating text below (inline functions)
ar &lt;- attack_rate(nrow(linelist_cleaned), population, multiplier = 10000)

ar %&gt;%
  merge_ci_df(e = 3) %&gt;% # merge the lower and upper CI into one column
  rename(&quot;Cases (n)&quot; = cases, 
         &quot;Population&quot; = population, 
         &quot;AR (per 100,000)&quot; = ar, 
         &quot;95%CI&quot; = ci) %&gt;% 
  select(-Population) %&gt;% # drop the population column as it is not changing
  knitr::kable(digits = 2, align = &quot;r&quot;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Cases (n)</th>
<th align="right">AR (per 100,000)</th>
<th align="right">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1447</td>
<td align="right">232.13</td>
<td align="right">(220.60–244.25)</td>
</tr>
</tbody>
</table>
<p>We are unable to calculate the attack rate by age group, because we do not have population counts for each age group.</p>
<p>Mortality attributable to AJS - not appropriate for this example because…</p>
</div>
