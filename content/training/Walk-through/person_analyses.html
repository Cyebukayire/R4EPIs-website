---
date: "2019-08-21T10:38:36+02:00"
title: Person analyses
weight: 12
---



<p>TODO [general description of person section]</p>
<div id="demographic-tables" class="section level3">
<h3>Demographic Tables:</h3>
<p>The first demographic table presents patients by their age group (the table’s rows) and their relationship with the case definition (the table’s columns). This chunk uses piping (%&gt;%, see reference TODO HERE) to link six different functions and produce a table:</p>
<ul>
<li>The tab_linelist() function creates a frequency and percent table of age_group, with columns differentiating by case_def value<br />
</li>
<li>The select() function removes an unnecessary column “variable” generated by tab_linelist().<br />
</li>
<li>The rename() function renames the default column “value” as “Age Group”<br />
</li>
<li>The rename_redundant() function replaces any column name that has proportion with “%”<br />
</li>
<li>The augment_redundant() command replaces any column name with n with &quot; cases (n)&quot;<br />
</li>
<li>The kable() command completes the table, in this case with one digit after each decimal</li>
</ul>
<pre class="r"><code># Describe observations by age_group and case_def
tab_linelist(linelist_cleaned, 
             age_group, strata = case_def, 
             col_total = TRUE, row_total = TRUE) %&gt;%
  select(-variable) %&gt;%
  rename(&quot;Age group&quot; = value) %&gt;%
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; cases (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 8 missing values</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">Confirmed cases (n)</th>
<th align="right">%</th>
<th align="right">Probable cases (n)</th>
<th align="right">%</th>
<th align="right">Suspected cases (n)</th>
<th align="right">%</th>
<th align="right">Missing cases (n)</th>
<th align="right">%</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">4</td>
<td align="right">4.0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">41</td>
<td align="right">5.8</td>
<td align="right">23</td>
<td align="right">3.6</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">30</td>
<td align="right">30.3</td>
<td align="right">1</td>
<td align="right">16.7</td>
<td align="right">289</td>
<td align="right">41.1</td>
<td align="right">321</td>
<td align="right">50.9</td>
<td align="right">641</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">46</td>
<td align="right">46.5</td>
<td align="right">2</td>
<td align="right">33.3</td>
<td align="right">248</td>
<td align="right">35.3</td>
<td align="right">181</td>
<td align="right">28.7</td>
<td align="right">477</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">15</td>
<td align="right">15.2</td>
<td align="right">2</td>
<td align="right">33.3</td>
<td align="right">96</td>
<td align="right">13.7</td>
<td align="right">76</td>
<td align="right">12.0</td>
<td align="right">189</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">4</td>
<td align="right">4.0</td>
<td align="right">1</td>
<td align="right">16.7</td>
<td align="right">29</td>
<td align="right">4.1</td>
<td align="right">30</td>
<td align="right">4.8</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">99</td>
<td align="right">100.0</td>
<td align="right">6</td>
<td align="right">100.0</td>
<td align="right">703</td>
<td align="right">100.0</td>
<td align="right">631</td>
<td align="right">100.0</td>
<td align="right">1439</td>
</tr>
</tbody>
</table>
<p>You can change the argument strata = to refer to any number of variables (in this next example, sex). To show proportions of the total population of observations, add the argument prop_total specified as TRUE, as below.</p>
<pre class="r"><code>tab_linelist(linelist_cleaned, 
             age_group, strata = sex,
             col_total = TRUE, row_total = TRUE, prop_total = TRUE) %&gt;% 
  select(-variable) %&gt;%
  rename(&quot;Age group&quot; = value) %&gt;%
#  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; cases (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<pre><code>## Warning in descriptive(x, counter = !!i, grouper = !!stra, proptotal =
## prop_total, : Removing 8 missing values</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">F cases (n)</th>
<th align="right">F proportion</th>
<th align="right">M cases (n)</th>
<th align="right">M proportion</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">26</td>
<td align="right">1.8</td>
<td align="right">42</td>
<td align="right">2.9</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">223</td>
<td align="right">15.5</td>
<td align="right">418</td>
<td align="right">29.0</td>
<td align="right">641</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">317</td>
<td align="right">22.0</td>
<td align="right">160</td>
<td align="right">11.1</td>
<td align="right">477</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">118</td>
<td align="right">8.2</td>
<td align="right">71</td>
<td align="right">4.9</td>
<td align="right">189</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">32</td>
<td align="right">2.2</td>
<td align="right">32</td>
<td align="right">2.2</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">716</td>
<td align="right">49.8</td>
<td align="right">723</td>
<td align="right">50.2</td>
<td align="right">1439</td>
</tr>
</tbody>
</table>
<p>You can also choose to exclude or edit the <strong>in-line code</strong> that gives a count of the missing cases by sex and age_group.</p>
</div>
<div id="age-pyramids" class="section level3">
<h3>Age pyramids</h3>
<p>To print an age pyramid in your report, use the code below. A few things to note:</p>
<ul>
<li>The <strong>variable for split_by should have two non-missing value options</strong> (e.g. Male or Female, Oui or Non, etc.)<br />
</li>
<li>The variable names work with or without quotation marks<br />
</li>
<li>The dashed lines in the bars are the midpoint of the un-stratified age group<br />
</li>
<li>You can adjust the position of the legend by replacing legend.position = “bottom” with “top”, “left”, or “right”<br />
</li>
<li>Read more by searching plot_age_pyramid in the Help tab of the lower-right RStudio pane</li>
</ul>
<p>You can make this a pyramid of months by supplying age_group_mon to the age_group argument.</p>
<pre class="r"><code># plot age pyramid by sex 
plot_age_pyramid(linelist_cleaned, 
                 age_group = &quot;age_group&quot;, 
                 split_by = &quot;sex&quot;) + 
  labs(y = &quot;Cases (n)&quot;, x = &quot;Age group&quot;) + # change axis  labels (nb. x/y flip)
  theme(legend.position = &quot;bottom&quot;,     # move legend to bottom
        legend.title = element_blank(), # remove title
        text = element_text(size = 18)  # change text size
       )</code></pre>
<p><img src="/training/Walk-through/person_analyses_files/figure-html/age_pyramid-1.png" width="720" /></p>
<p><strong>To have an age pyramid of patients under 2 by month age groups</strong>, it is best to add a filter() step to the beginning of the code chunk, as below. This step selects for linelist_cleaned observations that meet the specified critera and passes that reduced dataset through the “pipes” to the next function: (plot_age_pyramid()). If this filter() step is not added, you will see that the largest pyramid bars are of “missing” - these are the patients old enough to not have a months age group.</p>
<p>Note that the filter step does not drop any observations from the linelist_cleaned object itself. Because the filter is <strong>not</strong> being assigned (<code>&lt;-</code>) to over-write linelist_cleaned, this filter is only temporarily applied for the purpose of producing the age pyramid.</p>
<pre class="r"><code># plot age pyramid by month groups, for observations under 2 years
filter(linelist_cleaned, age_years &lt;= 2) %&gt;%
  plot_age_pyramid(age_group = &quot;age_group_mon&quot;,
                   split_by = &quot;sex&quot;) +
                  # stack_by = &quot;case_def&quot;) +
  labs(y = &quot;Cases (n)&quot;, x = &quot;Age group (months)&quot;) + # change axis  labels (nb. x/y flip)
  theme(legend.position = &quot;bottom&quot;,     # move legend to bottom
        legend.title = element_blank(), # remove title
        text = element_text(size = 18)  # change text size
       )</code></pre>
<p><img src="/training/Walk-through/person_analyses_files/figure-html/age_pyramid_under_two-1.png" width="720" /></p>
</div>
<div id="inpatient-statistics" class="section level3">
<h3>Inpatient statistics</h3>
<p>The text following the age pyramids uses <strong>in-line code</strong> to describe the distribution of outpatient and inpatient observations, and descriptive statistics of the length of stay for inpatients. <strong>The Am Timan dataset does not have length of stay</strong>, so it is best to delete those sentences for the final report.</p>
</div>
<div id="symptom-and-lab-descriptives" class="section level3">
<h3>Symptom and lab descriptives</h3>
<p>This next code also uses the tab_linelist() function to <strong>create descriptive tables of all the variables that were included in the SYMPTOMS variable list</strong>.</p>
<ul>
<li>In the tab_linelist() function, SYMPTOMS (the value supplied to the second argument) is an object we defined in data cleaning that is a list of variables to tabulate. If this code produces an error about an “Unknown column”, ensure that the variables in the object SYMPTOMS are <em>all</em> present in your dataset (and spelled correctly).</li>
<li>Also in tab_linelist(), the argument <code>keep =</code> must represent the character value to be counted for the the table. As these Am Timan variables are still in French, we change <code>keep = &quot;Yes&quot;</code> to <code>keep = &quot;Oui&quot;</code>.<br />
</li>
<li>The mutate() function is aesthetically changing variable names with underscores to spaces.</li>
</ul>
<pre class="r"><code># get counts and proportions for all variables named in SYMPTOMS
tab_linelist(linelist_cleaned, SYMPTOMS, keep = &quot;Oui&quot;) %&gt;% 
  select(-value) %&gt;%
  # fix the way symptom names are displayed
  mutate(variable = str_to_sentence(gsub(&quot;_&quot;, &quot; &quot;, variable))) %&gt;%
  # rename accordingly
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">n</th>
<th align="right">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Generalized itch</td>
<td align="right">520</td>
<td align="right">64.8</td>
</tr>
<tr class="even">
<td align="left">Fever</td>
<td align="right">679</td>
<td align="right">84.2</td>
</tr>
<tr class="odd">
<td align="left">Joint pains</td>
<td align="right">244</td>
<td align="right">30.6</td>
</tr>
<tr class="even">
<td align="left">Epigastric pain heartburn</td>
<td align="right">477</td>
<td align="right">59.4</td>
</tr>
<tr class="odd">
<td align="left">Nausea anorexia</td>
<td align="right">432</td>
<td align="right">53.7</td>
</tr>
<tr class="even">
<td align="left">Vomiting</td>
<td align="right">465</td>
<td align="right">57.8</td>
</tr>
<tr class="odd">
<td align="left">Diarrhoea</td>
<td align="right">114</td>
<td align="right">14.2</td>
</tr>
<tr class="even">
<td align="left">Bleeding</td>
<td align="right">52</td>
<td align="right">6.5</td>
</tr>
<tr class="odd">
<td align="left">Headache</td>
<td align="right">641</td>
<td align="right">79.9</td>
</tr>
</tbody>
</table>
<p>The code for the lab table is very similar, but has this difference:</p>
<ul>
<li>In the initial tab_linelist() command, <code>transpose = &quot;value&quot;</code> is set because the values in the lab data are important in-and-of themselves (e.g. IgM+/IgG-, etc.) - i.e. the values should become column headers.</li>
</ul>
<p><em>Note: This table may be large and unwieldy at first, until you clean your data. The step in data cleaning where we converted 0, 1, “yes”, “pos”, “neg”, etc. to standardized “Positive” and “Negative” was crucial towards making this table readable. Once kitted into a word document, you will likely need to adjust the font size, column widths, etc.</em></p>
<pre class="r"><code># get counts and proportions for all variables named in LABS
tab_linelist(linelist_cleaned, LABS, 
             transpose = &quot;value&quot;) %&gt;% 
  # fix the way lab test names are displayed
  mutate(variable = str_to_sentence(gsub(&quot;_&quot;, &quot; &quot;, variable))) %&gt;%
  # rename accordingly
  rename(&quot;Lab test&quot; = variable) %&gt;%
  rename_redundant(&quot;%&quot; = proportion) %&gt;%
  augment_redundant(&quot; (n)&quot; = &quot; n$&quot;) %&gt;%
  kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Lab test</th>
<th align="right">Negative (n)</th>
<th align="right">%</th>
<th align="right">Positive (n)</th>
<th align="right">%</th>
<th align="right">IgG-/IgM- (n)</th>
<th align="right">%</th>
<th align="right">IgG±/IgM- (n)</th>
<th align="right">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hep b rdt</td>
<td align="right">222</td>
<td align="right">91.4</td>
<td align="right">21</td>
<td align="right">8.6</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Hep c rdt</td>
<td align="right">240</td>
<td align="right">99.2</td>
<td align="right">2</td>
<td align="right">0.8</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Hep e rdt</td>
<td align="right">150</td>
<td align="right">60.0</td>
<td align="right">100</td>
<td align="right">40.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Test hepatitis a</td>
<td align="right">23</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Test hepatitis b</td>
<td align="right">22</td>
<td align="right">95.7</td>
<td align="right">1</td>
<td align="right">4.3</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Test hepatitis c</td>
<td align="right">23</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Test hepatitis e igm</td>
<td align="right">21</td>
<td align="right">33.9</td>
<td align="right">41</td>
<td align="right">66.1</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Test hepatitis e genotype</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">2</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Test hepatitis e virus</td>
<td align="right">7</td>
<td align="right">11.3</td>
<td align="right">1</td>
<td align="right">1.6</td>
<td align="right">9</td>
<td align="right">14.5</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Malaria rdt at admission</td>
<td align="right">161</td>
<td align="right">63.6</td>
<td align="right">92</td>
<td align="right">36.4</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Dengue</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">12</td>
<td align="right">50.0</td>
<td align="right">1</td>
<td align="right">4.2</td>
</tr>
<tr class="even">
<td align="left">Yellow fever</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">19</td>
<td align="right">79.2</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="odd">
<td align="left">Chikungunya onyongnyong</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">21</td>
<td align="right">87.5</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr class="even">
<td align="left">Other arthropod transmitted virus</td>
<td align="right">24</td>
<td align="right">100.0</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
</tbody>
</table>
</div>
<div id="case-fatality-ratio-cfr" class="section level2">
<h2>Case Fatality Ratio (CFR)</h2>
<p>The opening text with in-line code must be edited to match our Am Timan data. The second in-line code references the variable exit_status and the value “Dead” - <strong>we know that it must now reference the variable exit_status2 and the value “Died”</strong>. Also, we do not have Dead on Arrival recorded in our dataset. Likewise, <strong>the section on time-to-death does not apply to our dataset and can be deleted.</strong></p>
<p>TODO: PNG image of in-line code edited to be correct</p>
<p>Overall CFR is produced with the code below. Note the following:</p>
<ul>
<li>This code requires the variable patient_facility_type, that it has a value “Inpatient”, and the DIED variable.<br />
</li>
<li>A filter is applied that restricts this table to Inpatient observations only.<br />
</li>
<li>rename() is used to change the column labels in the table</li>
</ul>
<pre class="r"><code># use arguments from above to produce overal CFR
overall_cfr &lt;- linelist_cleaned %&gt;% 
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  case_fatality_rate_df(deaths = DIED, mergeCI = TRUE) %&gt;%
  rename(&quot;Deaths&quot; = deaths,
         &quot;Cases&quot; = population,
         &quot;CFR (%)&quot; = cfr,
         &quot;95%CI&quot; = ci)
  knitr::kable(overall_cfr, digits = 1)         # print nicely with 1 decimal digit</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>The next code adds arguments to case_fatality_rate_df() such as <code>group = sex</code> (which stratified the CFR by sex), and <code>add_total = TRUE</code> (which makes a total row across the sex groups).</p>
<pre class="r"><code>linelist_cleaned %&gt;%
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  mutate(sex = forcats::fct_explicit_na(sex, &quot;-&quot;)) %&gt;%
  case_fatality_rate_df(deaths = DIED, group = sex, mergeCI = TRUE, add_total = TRUE) %&gt;%
  rename(&quot;Sex&quot; = sex, 
         &quot;Deaths&quot; = deaths, 
         &quot;Cases&quot; = population, 
         &quot;CFR (%)&quot; = cfr, 
         &quot;95%CI&quot; = ci) %&gt;% 
  knitr::kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Sex</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="right">11</td>
<td align="right">55</td>
<td align="right">20.0</td>
<td align="left">(11.55–32.36)</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="right">2</td>
<td align="right">31</td>
<td align="right">6.5</td>
<td align="left">(1.79–20.72)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
<p>When creating a table of CFR by age groups, one additional step, using the function complete() is required to ensure that all age_group levels are shown even if they have no observations.</p>
<pre class="r"><code>linelist_cleaned %&gt;%
  filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
  case_fatality_rate_df(deaths = DIED, group = age_group, mergeCI = TRUE, add_total = TRUE) %&gt;%
  tidyr::complete(age_group, 
                  fill = list(deaths = 0, 
                              population = 0, 
                              cfr = 0, 
                              ci = 0)) %&gt;% # Ensure all levels are represented
  rename(&quot;Age group&quot; = age_group, 
         &quot;Deaths&quot; = deaths, 
         &quot;Cases&quot; = population, 
         &quot;CFR (%)&quot; = cfr, 
         &quot;95%CI&quot; = ci) %&gt;% 
  knitr::kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Age group</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0-2</td>
<td align="right">4</td>
<td align="right">11</td>
<td align="right">36.4</td>
<td align="left">(15.17–64.62)</td>
</tr>
<tr class="even">
<td align="left">3-14</td>
<td align="right">1</td>
<td align="right">17</td>
<td align="right">5.9</td>
<td align="left">(1.05–26.98)</td>
</tr>
<tr class="odd">
<td align="left">15-29</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">13.9</td>
<td align="left">(6.08–28.66)</td>
</tr>
<tr class="even">
<td align="left">30-44</td>
<td align="right">2</td>
<td align="right">17</td>
<td align="right">11.8</td>
<td align="left">(3.29–34.34)</td>
</tr>
<tr class="odd">
<td align="left">45+</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">25.0</td>
<td align="left">(4.56–69.94)</td>
</tr>
<tr class="even">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
<tr class="odd">
<td align="left">-</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.0</td>
<td align="left">(0.00–79.35)</td>
</tr>
</tbody>
</table>
<p>The commented code below examines <strong>CFR by case definition</strong>. Note that this is dependant upon our working case_def variable.</p>
<pre class="r"><code># Use if you have enough confirmed cases for comparative analysis 

 linelist_cleaned %&gt;%
   filter(patient_facility_type == &quot;Inpatient&quot;) %&gt;%
   case_fatality_rate_df(deaths = DIED, group = case_def, mergeCI = TRUE, add_total = TRUE) %&gt;%
   rename(&quot;Case definition&quot; = case_def, 
          &quot;Deaths&quot; = deaths, 
          &quot;Cases&quot; = population, 
          &quot;CFR (%)&quot; = cfr, 
          &quot;95%CI&quot; = ci) %&gt;% 
   knitr::kable(digits = 1)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Case definition</th>
<th align="right">Deaths</th>
<th align="right">Cases</th>
<th align="right">CFR (%)</th>
<th align="left">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Confirmed</td>
<td align="right">8</td>
<td align="right">44</td>
<td align="right">18.2</td>
<td align="left">(9.51–31.96)</td>
</tr>
<tr class="even">
<td align="left">Suspected</td>
<td align="right">5</td>
<td align="right">42</td>
<td align="right">11.9</td>
<td align="left">(5.19–25.00)</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">13</td>
<td align="right">86</td>
<td align="right">15.1</td>
<td align="left">(9.05–24.16)</td>
</tr>
</tbody>
</table>
</div>
<div id="attack-rate" class="section level2">
<h2>Attack Rate</h2>
<p>To use the attack rate section, we need to modify the first code slightly. An object “population” is created from the sum of population counts in the population figures. <strong>Because we only imported region-based population counts, we must change this command</strong> to reflect that we do not have population_data_age, but rather population_data_region.</p>
<pre class="r"><code># OLD command from template 
# population &lt;- sum(population_data_age$population)</code></pre>
<p>Running the correct command and printing the value of population, we see that the sum population across regions is estimated to be 62336.</p>
<pre class="r"><code># Corrected command for Am Timan exercise
population &lt;- sum(population_data_region$population)

population</code></pre>
<pre><code>## [1] 62336</code></pre>
<p>The first line of code below creates a multi-part object <code>ar</code> with the number of cases, population, attack rate per 10,000, and lower and upper confidence intervals (you can run just this line to verify yourself). The subsequent commands alter the aesthetics of to produce a neat table with appropriate column names.</p>
<pre class="r"><code># calculate the attack rate information and store them in object &quot;ar&quot;&quot;
ar &lt;- attack_rate(nrow(linelist_cleaned), population, multiplier = 10000)

# Create table from the information in the object &quot;ar&quot;&quot;
ar %&gt;%
  merge_ci_df(e = 3) %&gt;% # merge the lower and upper CI into one column
  rename(&quot;Cases (n)&quot; = cases, 
         &quot;Population&quot; = population, 
         &quot;AR (per 10,000)&quot; = ar, 
         &quot;95%CI&quot; = ci) %&gt;% 
  select(-Population) %&gt;% # drop the population column as it is not changing
  knitr::kable(digits = 1, align = &quot;r&quot;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Cases (n)</th>
<th align="right">AR (per 10,000)</th>
<th align="right">95%CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1447</td>
<td align="right">232.1</td>
<td align="right">(220.60–244.25)</td>
</tr>
</tbody>
</table>
<p>We are unable to calculate the attack rate by age group, because we do not have population counts for each age group.</p>
<p>Mortality attributable to AJS - not appropriate for this example because… TODO</p>
</div>
