---
date: "2019-08-21T09:22:02+02:00"
title: Packages and initial setup
menuTitle: Packages
weight: 6
---


```{r setup, include=FALSE, results='hide', message=FALSE, warning=FALSE}
# hide all code chunks in the output, but show errors
knitr::opts_chunk$set(echo = TRUE,       # hide all code chunks in output
                      error = TRUE,       # show errors if they appear, but don't stop
                      fig.width = 6*1.25, # Figure width
                      fig.height = 6      # Figure height
                     )
# set default NA to - in output, define figure width/height
options(knitr.kable.NA = "-")

# Installing required packages for this template
required_packages <- c("knitr",       # create output docs
                       "dplyr",       # clean/shape data
                       "forcats",     # clean/shape data
                       "stringr",     # clean text
                       "rio",         # read in data
                       "ggplot2",     # create plots and charts
                       "sitrep",      # MSF field epi functions
                       "linelist",    # Functions for cleaning/standardising data
                       "incidence",   # create epicurves
                       "aweek",       # define epi weeks
                       "epitools",    # 2x2 tables and other epi goodness
                       "epitrix",     # epi helpers and tricks
                       "sf",          # encode spatial vector data
                       "ggspatial",   # plot maps
                       "here")        # locate files

for (pkg in required_packages) {
  # install packages if not already present
  if (!pkg %in% rownames(installed.packages())) {
    install.packages(pkg)
  }
  
  # load packages to this current session 
  library(pkg, character.only = TRUE)
}


# set default text size to 16 for plots
# give classic black/white axes for plots
ggplot2::theme_set(theme_classic(base_size = 18))

# Set the day that defines the beginning of your epiweek.
# you can start the week on any day of the week
# (the ISO standard is to start on Monday) 
aweek::set_week_start("Monday")
```


## Overview of template 

**TODO: Graphic or VIDEO? showing big-picture overview of template parts - waiting until final arrangement of chunks in template**

## Header and introduction

The very top of the template consists of a header surrounded by `---` lines. Here you may want to edit the title of your document. The other settings in the header define the default document type produced (Microsoft Word) when the RMarkdown is "knit".

The "Introduction to this template" section is for your information only and this text can be deleted before knitting the document.  

<img src="/images/AJS_Intro.png" alt="AJS Header and Introduction snip", width = "75%">


## Installation and loading packages
**The text which explains the purpose of this code chunk may be deleted, but you must keep the code chunk!** The code will run without producing any output in your final report, but it is required to install (or load using library(), if already installed) the packages necessary to produce the report.  

This "setup" code chunk does the following:  

* Set default settings for tables such as size, error handling, and display of missing values  

* Create a vector of names of packages required for the template to run, each of which is installed if it is not already installed, and then is loaded using library() for use in the current R session.

* Set default text size in graphic plots  

* Set epidemiological weeks to begin on Mondays  

<img src="/images/Package_Installation.png" alt="Package installation chunk snip", width = "75%">


### About the packages used in this template  

#### Generic packages  

* knitr used to create the output document (pdf, doc, html)  
* dplyr used to clean and shape the data  
* forcats used to clean and shape the data  
* stringr used to clean text/characters  
* rio used to read in data  
* epitrix used for data cleaning and variable standardisation  
* ggplot2 used to visualise your data using different plotting methods  
* here used to locate files

#### More epidemiology-specific packages  

* sitrep includes a variety of useful field epidemiology functions
* linelist used for cleaning and standardising data  
* incidence used for creating epicurves  
* aweek used for creating epiweeks  
* epitools used for creating 2by2 tables  
* epitrix used for helpful epidemiological tasks  

#### Mapping packages  

* ggspatial used for selecting basemap tiles  
* sf used for manipulating spatial objects (e.g. polygons) easily




## Set current epi week  

Set the epidemiological week for the report. **This value is used in later code chunks, for example when producing epidemic curves.** Note that you may want to specify the most recent **complete** epi week. Follow the format in the code below (within quotes give the 4-digit year, a hyphen (-), capital W, then the 2-digit epi week number).  

By default in the templates epi weeks begin on Mondays (this can be changed at the bottom of the "setup" code chunk). See the documentation of the [package "aweek"](https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html) for more information. 

To determine which epi week of a date you can use the date2week() function. It will tell you the year, week, and day number of the provided date. Let's assume the date we want to use for this analysis is 20 April, 2017.

```{r}
set_week_start("Monday")     # Define the first day of the epi week
date2week("2017-04-20")      # Ask for the epi week of this date
```

```{r}
reporting_week <- "2017-W16"  # Set reporting_week for our template
```

*Note: If you want to use the automatically-updated date from your computer, use Sys.Date() like this: `date2week(Sys.Date())`.*


```{r, include=FALSE, results='hide', message=FALSE, warning=FALSE}
# Save linelist_raw as "linelist_raw" for use in the next page (dataset alignment).
saveRDS(reporting_week, "data/reporting_week.rds")
```

