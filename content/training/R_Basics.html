---
date: "2019-07-31T11:05:34+02:00"
title: R Basics
weight: 7
output:
  blogdown::html_page:
    toc: true
---


<div id="TOC">
<ul>
<li><a href="#online-resources">Online resources</a></li>
<li><a href="#everything-is-an-object">Everything is an object</a><ul>
<li><a href="#creating-objects-with-the-assignment-operator--">Creating objects with the Assignment Operator &lt;-</a></li>
<li><a href="#objects-can-have-structure">Objects can have Structure</a></li>
<li><a href="#objects-have-classes">Objects have Classes</a></li>
</ul></li>
<li><a href="#functions">Functions</a><ul>
<li><a href="#simple-functions">Simple Functions</a></li>
<li><a href="#functions-with-multiple-arguments">Functions with Multiple Arguments</a></li>
<li><a href="#using-additional-functions">Using Additional Functions</a></li>
<li><a href="#the-pipe-operator-between-functions">The Pipe Operator %&gt;% between functions</a></li>
<li><a href="#help-with-functions">Help with functions</a></li>
</ul></li>
<li><a href="#relational-and-logical-operators">Relational and logical operators</a></li>
<li><a href="#missing-values">Missing Values</a></li>
<li><a href="#calculations">Calculations</a></li>
<li><a href="#working-with-dates">Working with Dates</a><ul>
<li><a href="#converting-date-variables-to-the-date-class">Converting date variables to the date class</a></li>
<li><a href="#epidemiological-weeks">Epidemiological weeks</a></li>
</ul></li>
<li><a href="#general-syntax">General Syntax</a></li>
<li><a href="#errors-and-warnings">Errors and Warnings</a></li>
</ul>
</div>

<div id="online-resources" class="section level2">
<h2>Online resources</h2>
<p>Below are links to some of the many online tutorials for learning R.</p>
<p><a href="http://swcarpentry.github.io/r-novice-gapminder/">Fundamentals of R</a></p>
<p><a href="https://learn.r-journalism.com/en/introduction/">R for Novices (written for journalists)</a></p>
<p><a href="http://rpubs.com/michaelmarks/R-Clin-Epi">Clinical Epidemiology in R, from London School of Hygiene &amp; Tropical Medicine</a></p>
<p><a href="https://www.repidemicsconsortium.org/resources/">Resources page of R for Epidemics Consortium (RECON) website</a></p>
<p><a href="http://r-statistics.co/Complete-Ggplot2-Tutorial-Part1-With-R-Code.html">Tutorial for learning ggplot (the most common R package for visualizations, graphs, and maps)</a></p>
<p><strong>Googling</strong><br />
Typically when you are “stuck”, it is a good strategy to use Google to find notes from other people who have worked through your same problem. If you phrase your search terms carefully, relevant results from Question/Answer sites such as <a href="https://stackoverflow.com/questions/tagged/r">StackExchange</a> will appear and you can often get insights on approach, code examples, and be pointed toward other resources. If you decide to post a question yourself, use these <a href="https://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example">guidelines</a>.</p>
</div>
<div id="everything-is-an-object" class="section level2">
<h2>Everything is an object</h2>
<p>Everything you store in R - datasets, variables, a list of village names, a total population number, even outputs such as graphs - are <strong>objects</strong> which are <strong>assigned a name</strong> and <strong>can be referenced</strong> in later commands.</p>
<p>An object exists when you have assigned it a value (see the assignment section below). When it is assigned a value, the object appears in the Environment (see the upper right pane of RStudio). It can then be operated upon, manipulated, changed, and re-defined.</p>
<div id="creating-objects-with-the-assignment-operator--" class="section level3">
<h3>Creating objects with the Assignment Operator &lt;-</h3>
<p><strong>You create objects <em>by assigning them a value</em> with the &lt;- operator.</strong> You can think of the assignment operator <code>&lt;-</code> as the words “is defined as”. Assignment commands generally follow a standard order:</p>
<p><strong>object_name</strong> &lt;- <strong>value</strong> (or process/calculation that produce a value)</p>
<blockquote>
<p><strong>As an example:</strong> While using an outbreak template you may want to record the current reporting week for later reference. In this example, the object reporting_week is created when it is assigned the character value “2018-W10”. reporting_week will appear in the R Environment (upper-right pane) and can be referenced in later commands.</p>
</blockquote>
<blockquote>
<p>See the commands and their output in the boxes below. Note the [1] in the output is simply indicating that you are viewing the first (and only) item of the output</p>
</blockquote>
<pre class="r"><code>reporting_week &lt;- &quot;2018-W10&quot;   # creates the object reporting_week by assigning a value

reporting_week                 # prints the current value of reporting_week</code></pre>
<pre><code>## [1] &quot;2018-W10&quot;</code></pre>
<p><em>IMPORTANT: <strong>An object’s value can be over-written</strong> at any time by running an assignment command to re-define its value. Thus, the <strong>order of the commands run is very important</strong>.</em></p>
<pre class="r"><code>reporting_week &lt;- &quot;2018-W51&quot;   # assigns a NEW value to the object reporting_week

reporting_week                 # prints the current value of reporting_week</code></pre>
<pre><code>## [1] &quot;2018-W51&quot;</code></pre>
<p><strong>Datasets are also assigned names and defined as objects when they are imported.</strong> In the code below:</p>
<ol style="list-style-type: decimal">
<li><p>The object linelist_raw is created and assigned the value of an imported CSV file</p></li>
<li><p>The object linelist_cleaned is created and assigned the value of linelist_raw</p></li>
<li><p>linelist_cleaned is re-defined as itself, but mutated to include a new variable, obs_days, representing the number of days between patient admission and exit</p></li>
</ol>
<pre class="r"><code># linelist_raw is created and assigned the value of the imported CSV file
linelist_raw &lt;- rio::import(&quot;linelist.csv&quot;)

# linelist_cleaned is created and assigned the value of linelist_raw
linelist_cleaned &lt;- linelist_raw

# linelist_cleaned is RE-defined as itself, but modified to include a new variable
linelist_cleaned &lt;- mutate(linelist_cleaned, 
                           obs_days = as.numeric(date_of_exit - date_of_admission))</code></pre>
<p>You can read more about importing and exporting datasets with the rio package <a href="https://rdrr.io/cran/rio/f/vignettes/rio.Rmd">here</a></p>
<p>A quick note on naming of objects:</p>
<ul>
<li>Object names must not contain spaces, but you should use underscore (_) or a period (.) instead of a space.<br />
</li>
<li>Object names are case-sensitive (meaning that Dataset_A is different from dataset_A).</li>
<li>Object names must begin with a letter (cannot begin with a number like 1, 2 or 3).</li>
</ul>
</div>
<div id="objects-can-have-structure" class="section level3">
<h3>Objects can have Structure</h3>
<p>Objects can be a single piece of data (e.g. <code>my_number &lt;- 24</code>), or they can consist of structured data. The graphic below, sourced from <a href="http://venus.ifca.unican.es/Rintro/dataStruct.html">this online R tutorial</a> shows some common data structures and their names. Not included in this image is spatial data, which is discussed in another page.</p>
<div class="figure">
<img src="/images/r_data_structures.png" />

</div>
<p>Using the templates, you will <em>most commonly</em> encounter data frames and vectors:</p>
<table>
<colgroup>
<col width="24%" />
<col width="45%" />
<col width="30%" />
</colgroup>
<thead>
<tr class="header">
<th>Common structure</th>
<th>Explanation</th>
<th>Example from templates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Vectors</td>
<td>A container for a sequence of singular objects, all of the same class (e.g. numeric, character).</td>
<td><strong>“Variables” (columns) in data frames are vectors</strong> (e.g. the variable age_years).</td>
</tr>
<tr class="even">
<td>Data Frames</td>
<td>Vectors (e.g. columns) that are bound together that all have the same number of rows.</td>
<td>linelist_raw and linelist_cleaned are both data frames.</td>
</tr>
</tbody>
</table>
<p>Note that to create a vector that “stands alone”, or is not part of a data frame (such as a list of location names), the function <code>c()</code> is often used:<br />
<code>list_of_names &lt;- c(&quot;Ruhengeri&quot;, &quot;Gisenyi&quot;, &quot;Kigali&quot;, &quot;Butare&quot;)</code></p>
<div id="using-to-accesscall-variables" class="section level4">
<h4>Using <code>$</code> to access/call variables</h4>
<p><strong>Vectors within a data frame (variables in a dataset) can be called or referenced using the $ symbol.</strong> The <code>$</code> symbol connects the name of the column to the name of its dataset. The $ symbol must be used, otherwise R will not know where to look for or create the column.</p>
<pre class="r"><code># Retrieve the length of the vector age_years
# (age_years is in the data frame linelist_cleaned)
length(linelist_cleaned$age_years)  </code></pre>
<pre><code>## [1] 300</code></pre>
<p>By typing the name of the data frame followed by <code>$</code> you will also see a list of all variables in the data frame. You can scroll through them using arrow key, select one with your Enter key, and avoid spelling mistakes!</p>
<div class="figure">
<img src="/images/Calling_Names.gif" />

</div>
</div>
</div>
<div id="objects-have-classes" class="section level3">
<h3>Objects have Classes</h3>
<p>All the objects stored in R have a <em>class</em> which tells R how to handle the object. There are many possible classes, but common ones include:</p>
<table>
<colgroup>
<col width="8%" />
<col width="53%" />
<col width="37%" />
</colgroup>
<thead>
<tr class="header">
<th>Class</th>
<th>Explanation</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Character</td>
<td>These are text/words/sentences <strong>“within quotation marks”</strong>. Math cannot be done on these objects.</td>
<td>“Character objects are in quotation marks”</td>
</tr>
<tr class="even">
<td>Numeric</td>
<td>These are numbers and <strong>can include decimals</strong>. If within quotation marks the will be considered character.</td>
<td>23.1 or 14</td>
</tr>
<tr class="odd">
<td>Integer</td>
<td>Numbers that are <strong>whole only</strong> (no decimals)</td>
<td>-5, 14, or 2000</td>
</tr>
<tr class="even">
<td>Factor</td>
<td>These are vectors that have a <strong>specified order</strong> or hierarchy of values</td>
<td>Variable msf_involvement with ordered values N, S, SUB, and U.</td>
</tr>
<tr class="odd">
<td>Date</td>
<td><strong>Once R is told that certain data are Dates</strong>, these data can be manipulated and displayed in special ways. See the page on Dates for more information.</td>
<td>2018-04-12 or 15/3/1954 or Wed 4 Jan 1980</td>
</tr>
<tr class="even">
<td>Logical</td>
<td>Values must be one of the two special values TRUE or FALSE (note these are <strong>not</strong> “TRUE” and “FALSE” in quotation marks)</td>
<td>TRUE or FALSE</td>
</tr>
<tr class="odd">
<td>data.frame</td>
<td>A data frame is how R stores a <strong>typical dataset</strong>. It consists of vectors (columns) of data bound together, that all have the same number of observations (rows).</td>
<td>The example AJS dataset named linelist_raw contains 68 variables with 300 observations (rows) each.</td>
</tr>
</tbody>
</table>
<p><strong>You can test the class of an object by writing it within the function class()</strong>. Note: you can reference a specific column within a dataset using the <code>$</code> notation to separate the name of the dataset and the name of the column.</p>
<pre class="r"><code>class(linelist_raw$age_years)</code></pre>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<pre class="r"><code>class(linelist_raw$patient_origin)</code></pre>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>The templates sometimes contain code converting objects between classes.</p>
<table>
<colgroup>
<col width="22%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>as.character()</td>
<td>Converts to character class</td>
</tr>
<tr class="even">
<td>as.numeric()</td>
<td>Converts to numeric class</td>
</tr>
<tr class="odd">
<td>as.integer()</td>
<td>Converts to integer class</td>
</tr>
<tr class="even">
<td>as.Date()</td>
<td>Converts to Date class - Note: see section on dates for details</td>
</tr>
<tr class="odd">
<td>as.factor()</td>
<td>Converts to factor - Note: re-defining order of value levels requires extra arguments</td>
</tr>
</tbody>
</table>
<p><a href="https://swcarpentry.github.io/r-novice-inflammation/13-supp-data-structures/">Here</a> is more material on classes and data structures in R.</p>
</div>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<div id="simple-functions" class="section level3">
<h3>Simple Functions</h3>
<p>Most tasks in R are performed through functions. <strong>A function is like a machine that receives inputs, does some action with those inputs, and produces an output.</strong> What the output is depends on the function.</p>
<p>On installation, R contains “base” functions that perform common tasks. Specialized functions have been created by R users, verified by the R community, and can be downloaded within “packages” to your RStudio for use. One of the more challenging aspects of R is that there are often many functions to choose from to complete a given task.</p>
<p><strong>Functions typically operate upon some object placed within the function’s parentheses</strong>. For example, when the function summary() is used on a variable of class numeric, the output is a summary of the variable’s numeric and missing values.</p>
<pre class="r"><code>summary(linelist_raw$age_years)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    3.00   32.00   57.00   59.27   86.00  120.00      11</code></pre>
</div>
<div id="functions-with-multiple-arguments" class="section level3">
<h3>Functions with Multiple Arguments</h3>
<p>Functions often ask for several inputs. <strong>Each piece of information needed is called an argument</strong>. Some arguments are required for the function to work correctly, some are optional. Arguments can take character, numeric, logical (TRUE/FALSE), and other inputs. Optional arguments have default settings if they are not specified. <strong>Arguments are located within the parentheses of the function, usually separated by commas</strong>.</p>
<blockquote>
<p><strong>For example</strong>, this descriptive() command in the templates creates a descriptive summary table of counts and proportions. In this command the function is given three arguments, establishing linelist_cleaned as the data frame to use, age_group as the variable to count, and sex as the variable to use for groupings.</p>
</blockquote>
<pre class="r"><code># Creates a descriptive table by specifying the dataframe and two columns
descriptive(df = linelist_cleaned, counter = &quot;age_group&quot;, grouper = &quot;sex&quot;)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   age_group   F_n F_prop   M_n M_prop   U_n U_prop
##   &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 0-2           0   0        0      0     0   0   
## 2 3-14          6   5.41     9      9     7   7.87
## 3 15-29        15  13.5     17     17    17  19.1 
## 4 30-44         9   8.11     9      9    16  18.0 
## 5 45+          78  70.3     61     61    45  50.6 
## 6 Missing       3   2.70     4      4     4   4.49</code></pre>
<blockquote>
<p>Often, the first half of argument assignment (e.g. <code>df =</code>) does not need to be specified if the arguments are written in a specific order (specified in the function’s documentation). The below code produces the exact same table as above, because the function expects the argument order: data frame, counter variable, grouper variable.</p>
</blockquote>
<pre class="r"><code># This command will produce the same table as above
descriptive(linelist_cleaned, &quot;age_group&quot;, &quot;sex&quot;)</code></pre>
<p><strong>A more complex descriptive() command might include the optional arguments to add a Total column and row to the table.</strong> This is done by including the argument coltotals and rowtotals, both set to equal TRUE (their default is FALSE).</p>
<p><em>Note: For arguments specified with an equals symbol (e.g. coltotals = …), their order among the arguments is not important (must still be within the parentheses and separated by commas).</em></p>
<pre class="r"><code>descriptive(linelist_cleaned, &quot;age_group&quot;, &quot;sex&quot;, coltotals = TRUE, rowtotals = TRUE)</code></pre>
<pre><code>## # A tibble: 7 x 8
##   age_group   F_n F_prop   M_n M_prop   U_n U_prop Total
##   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 0-2           0   0        0      0     0   0        0
## 2 3-14          6   5.41     9      9     7   7.87    22
## 3 15-29        15  13.5     17     17    17  19.1     49
## 4 30-44         9   8.11     9      9    16  18.0     34
## 5 45+          78  70.3     61     61    45  50.6    184
## 6 Missing       3   2.70     4      4     4   4.49    11
## 7 Total       111 100      100    100    89 100      300</code></pre>
</div>
<div id="using-additional-functions" class="section level3">
<h3>Using Additional Functions</h3>
<p>R comes with “base” functions, but the R community has created and verified many other specialized functions that are available to you. These <em>functions</em> are contained within <strong>packages</strong> that can be downloaded to your computer. Once downloaded, you access the functions within a package by calling the package with the library() command at the beginning of each R session.</p>
<p><strong>Note: While you only have to install packages once, you must load them at the beginning of every R session using library().</strong> There is a code chunk at the beginning of each template that loads the necessary packages.</p>
<p>Think of R as your personal library: When you download a package your library gains a book of functions, but each time you want to use a function in that book, you must borrow that book from your library.</p>
<p>For clarity in the templates, functions are often preceeded by the name of their package using the :: symbol in the following way:</p>
<p>package_name::function_name()</p>
<pre class="r"><code>#This line uses the package &quot;rio&quot;&quot; and it&#39;s function &quot;import&quot; to import a dataset
linelist_raw &lt;- rio::import(&quot;linelist.xlsx&quot;, which = &quot;Sheet1&quot;)</code></pre>
</div>
<div id="the-pipe-operator-between-functions" class="section level3">
<h3>The Pipe Operator %&gt;% between functions</h3>
<p>Within the template scripts you will see the pipe operator <code>%&gt;%</code>. Simply explained, the pipe operator passes an intermediate output from one function to the next. You can think of it as saying “then”. Many functions can be linked together with <code>%&gt;%</code>.</p>
<p>Piping is not a base function. To use piping, the dplyr package must be installed and loaded. Near the top of every template script is a code chunk that installs and loads the necessary packages, including dplyr. You can read more about piping <a href="https://magrittr.tidyverse.org/">here</a></p>
<blockquote>
<p><strong>As an example:</strong> The following code chunk from the AJD template data cleaning section can be read as “linelist_cleaned is defined as linelist_cleaned, filtered to remove the rows where the variables case_number and date_of_admission are missing”</p>
</blockquote>
<pre class="r"><code># only keep variables with a case ID and a date of consultation
linelist_cleaned &lt;- linelist_cleaned %&gt;% 
  filter(!is.na(case_number) &amp; !is.na(date_of_admission))</code></pre>
</div>
<div id="help-with-functions" class="section level3">
<h3>Help with functions</h3>
<p>To read more about a function, you can try searching online for resources OR use the Help tab in the lower-right R pane.</p>
<div class="figure">
<img src="/images/Function_Help.gif" />

</div>
</div>
</div>
<div id="relational-and-logical-operators" class="section level2">
<h2>Relational and logical operators</h2>
<p><strong>Relational operators compare values</strong> and are often used when defining new variables and subsets of datasets. Here are the common relational operators in R:</p>
<table style="width:88%;">
<colgroup>
<col width="20%" />
<col width="15%" />
<col width="16%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Operator</th>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Equal to</td>
<td><code>==</code></td>
<td><code>&quot;A&quot; == &quot;a&quot;</code></td>
<td><code>FALSE</code> (because R is case sensitive) <em>Note that == (double equals) is different from = (single equals), which acts like the assignment operator &lt;-</em></td>
</tr>
<tr class="even">
<td>Not equal to</td>
<td><code>!=</code></td>
<td><code>2 != 0</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="odd">
<td>Greater than</td>
<td><code>&gt;</code></td>
<td><code>4 &gt; 2</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td>Less than</td>
<td><code>&lt;</code></td>
<td><code>4 &lt; 2</code></td>
<td><code>FALSE</code></td>
</tr>
<tr class="odd">
<td>Greater than or equal to</td>
<td><code>&gt;=</code></td>
<td><code>6 &gt;= 4</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td>Less than or equal to</td>
<td><code>&lt;=</code></td>
<td><code>6 &lt;= 4</code></td>
<td><code>FALSE</code></td>
</tr>
<tr class="odd">
<td>Value is missing</td>
<td><code>is.na()</code></td>
<td><code>is.na(7)</code></td>
<td><code>FALSE</code> (special case, see section on missing values)</td>
</tr>
<tr class="even">
<td>Value is not missing</td>
<td><code>!is.na()</code></td>
<td><code>!is.na(7)</code></td>
<td><code>TRUE</code></td>
</tr>
</tbody>
</table>
<p><strong>Logical operators, such as AND and OR, are often used to connect relational operators and create more complicated criteria</strong>. Complex statements might require parentheses ( ) for grouping and order of application.</p>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>Operator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AND</td>
<td><code>&amp;</code></td>
</tr>
<tr class="even">
<td>OR</td>
<td><code>|</code> (vertical bar)</td>
</tr>
<tr class="odd">
<td>Parentheses</td>
<td>( ) Used to group criteria together and clarify order</td>
</tr>
</tbody>
</table>
<blockquote>
<p>For example, the command below use the function case_when to create the new variable “case_def” such that:</p>
</blockquote>
<pre class="r"><code>linelist_cleaned &lt;- linelist_cleaned %&gt;%
  mutate(case_def = case_when(
    is.na(hep_e_rdt) &amp; is.na(other_cases_in_hh)           ~ NA_character_,
    hep_e_rdt == &quot;Positive&quot;                               ~ &quot;Confirmed&quot;,
    hep_e_rdt != &quot;Positive&quot; &amp; other_cases_in_hh == &quot;Yes&quot;  ~ &quot;Probable&quot;,
    TRUE                                                  ~ &quot;Suspected&quot;
  ))</code></pre>
<table>
<colgroup>
<col width="53%" />
<col width="46%" />
</colgroup>
<thead>
<tr class="header">
<th>Criteria in example above</th>
<th>Resulting value in new variable “case_def”“</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>If the value for variables hep_e_rdt and other_cases_in_hh are missing</td>
<td>NA (missing)</td>
</tr>
<tr class="even">
<td>If the value in hep_e_rdt is “Positive”</td>
<td>“Confirmed”</td>
</tr>
<tr class="odd">
<td>If the value in hep_e_rdt is NOT “Positive” AND the value in other_cases_in_hh is “Yes”</td>
<td>“Probable”</td>
</tr>
<tr class="even">
<td>If one of the above criteria are not met</td>
<td>“Suspected”</td>
</tr>
</tbody>
</table>
<p><em>Note that R is case-sensitive, so “Positive” is different than “positive”…</em></p>
</div>
<div id="missing-values" class="section level2">
<h2>Missing Values</h2>
<p><strong>In R, missing values are represented by the special value NA</strong> (capital letters N and A - not in quotation marks). If you import data that records missing data in another way (e.g. 99, “Missing”, or .), you may want to re-code those values to NA.</p>
<p><strong>To test whether a value is NA, use the special function is.na()</strong>, which returns TRUE or FALSE.</p>
<pre class="r"><code>rdt_result &lt;- NA   # Assigns the object rdt_result with the value NA (missing)
is.na(rdt_result)  # Tests whether the value of rdt_result is NA</code></pre>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="calculations" class="section level2">
<h2>Calculations</h2>
<p>Mathematical operators are often used to perform addition, division, to create new columns, etc. Below are common mathematical operators in R. Whether you put spaces around the operators is not important.</p>
<table>
<thead>
<tr class="header">
<th>Objective</th>
<th>Example in R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>addition</td>
<td>2+3</td>
</tr>
<tr class="even">
<td>subtraction</td>
<td>2-3</td>
</tr>
<tr class="odd">
<td>multiplication</td>
<td>2*3</td>
</tr>
<tr class="even">
<td>division</td>
<td>30/5</td>
</tr>
<tr class="odd">
<td>exponent</td>
<td>2^3 or 2**3</td>
</tr>
<tr class="even">
<td>order of operations</td>
<td>( )</td>
</tr>
</tbody>
</table>
</div>
<div id="working-with-dates" class="section level2">
<h2>Working with Dates</h2>
<div id="converting-date-variables-to-the-date-class" class="section level3">
<h3>Converting date variables to the date class</h3>
<p>It is important to make R recognize when a variable contains dates. Dates are an object class and can be tricky to work with. The templates provides some code for converting variables to class date, but if your data are not standardized to a MSF data dictionary this process can require attention. <strong>The templates often use the function <code>guess_dates()</code>, but this guide will also demonstrate converting a variable to class date using the function as.Date().</strong></p>
<div id="the-function-guess_dates" class="section level4">
<h4>The function guess_dates()</h4>
<p><strong>The function guess_dates() attempts to read a “messy” date variable containing dates in many different formats and convert the dates to a standard format.</strong> You can read more about guess_dates(), which is in the “linelist” package, <a href="https://rdrr.io/github/reconhub/linelist/man/guess_dates.html">here</a>.</p>
<blockquote>
<p>For example, guess_dates would see the following dates “03 Jan 2018” “07/03/1982” “08/20/85” and convert them in the class Date to: 2018-01-03 1982-03-07 1985-08-20.</p>
</blockquote>
<p><em>Some optional arguments for guess_dates() that you might include are:</em></p>
<ul>
<li>error_tolerance - The proportion of entries which cannot be identified as dates to be tolerated (defaults to 0.1 or 10%)</li>
<li>last_date - the last valid date (defaults to current date)<br />
</li>
<li>first_date - the first valid date. Defaults to fifty years before the last_date.</li>
</ul>
<pre class="r"><code># An example using guess_dates on the variable dtdeath
linelist_cleaned$dtdeath &lt;- linelist::guess_dates(linelist_cleaned$dtdeath)

# An example from the template using guess_dates over multiple date variables, with piping, error tolerance of 50%, and the earliest accepted date of 1 Jan 2016.
linelist_cleaned &lt;- linelist_cleaned %&gt;%
   mutate_at(vars(matches(&quot;date|Date&quot;)), linelist::guess_dates,
           error_tolerance = 0.5, first_date = &quot;2016-01-01&quot;)</code></pre>
</div>
<div id="the-function-as.date" class="section level4">
<h4>The function as.Date()</h4>
<p>If guess_dates() is not working for you, you can use the base function as.Date() to convert a variable to class Date. <strong>as.Date() cannot guess dates, and therefore requires that all the date values be in the same format before converting.</strong> Read more about using as.Date() <a href="https://www.stat.berkeley.edu/~s133/dates.html">here</a></p>
<p>It can be easiest to first convert the variable to character class, and then convert to date class:</p>
<ol style="list-style-type: decimal">
<li>Turn the variable into character values using the function <code>as.character()</code></li>
</ol>
<pre class="r"><code>linelist_cleaned$date_of_onset &lt;- as.character(linelist_cleaned$date_of_onset)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Convert the variable from character values into date values, using the function <code>as.Date()</code><br />
(note the capital “D” in this function)<br />
</li>
</ol>
<ul>
<li><p>Within the <code>as.Date()</code> function, you must tell R which characters are which date components - which characters refer to the month, the day, and the year.</p></li>
<li><p>The codes are:<br />
%d = Day # (of the month e.g. 16, 17, 18…)<br />
%a = abbreviated weekday (Mon, Tues, Wed, etc.)<br />
%A = full weekday (Monday, Tuesday, etc.)<br />
%m = # of month (e.g. 01, 02, 03, 04)<br />
%b = abbreviated month (Jan, Feb, etc.)<br />
%B = Full Month (January, February, etc.)<br />
%y = 2-digit year (e.g. 89)<br />
%Y = 4-digit year (e.g. 1989)</p></li>
</ul>
<p>For example, if your character dates are in the format DD/MM/YYYY, like “24/04/1968”, then your command to turn the values into dates will be as below. <strong>Putting the format in quotation marks is necessary.</strong></p>
<pre class="r"><code>linelist_cleaned$date_of_onset &lt;- as.Date(linelist_cleaned$date_of_onset, format = &quot;%d/%m/%Y&quot;)</code></pre>
<p><strong>Note: the format= argument is <em>not</em> telling R the format you want the dates to be, but rather how to identify the date parts as they are <em>before</em> you run the command.</strong></p>
<p><em>Note: if your date parts are separated by a slash ( / ) instead of hyphen ( - ) , the format you tell R must also use slashes ( / ).</em></p>
<pre class="r"><code># Convert the variable to class Date by providing the format of the variable
linelist_cleaned$date_of_onset &lt;- as.Date(linelist_cleaned$date_of_onset, format=&quot;%Y-%m-%d&quot;)

# Check the class of the variable again
class(linelist_cleaned$date_of_onset)  </code></pre>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>Once the values are in class Date, R will present them in it’s standard format, which is YYYY-MM-DD.</p>
</div>
<div id="excel-dates" class="section level4">
<h4>Excel Dates</h4>
<p>Excel stores dates as the number of days since December 30, 1899. If the dataset you imported from Excel has a date variable showing numbers like “41369”… use the as.Date() function to convert, but <strong>instead of supplying a format as above, supply an origin date</strong>. Note that the origin date must be given in the default date format for R (“YYYY-MM-DD”).</p>
<pre class="r"><code># An example of providing an origin date when converting to class Date
linelist_cleaned$date_of_onset &lt;- as.Date(linelist_cleaned$date_of_onset, origin = &quot;1899-12-30&quot;)</code></pre>
</div>
<div id="changing-the-format-of-displayed-dates" class="section level4">
<h4>Changing the format of displayed dates</h4>
<p>Once dates are the correct class, you often want them to display differently. For example, “Monday 05 Jan” instead of 2018-01-05. You can do this with the function format() in a similar was to as.Date(). Read more about it <a href="https://www.statmethods.net/input/dates.html">here</a></p>
</div>
<div id="calculating-distance-between-dates" class="section level4">
<h4>Calculating distance between dates</h4>
<p>The difference between dates can be calculated by:</p>
<ol style="list-style-type: decimal">
<li>Correctly formating <em>both</em> date variable as class date (see instructions above)<br />
</li>
<li>Creating a new variable that is defined as one date variable subtracted from the other</li>
<li>Converting the result to numeric class (default is class “datediff”). This ensures that subsequent mathematical calculations can be performed.</li>
</ol>
</div>
</div>
<div id="epidemiological-weeks" class="section level3">
<h3>Epidemiological weeks</h3>
<p>The templates use the very flexible package “aweek”&quot; to set epidemiological weeks. You can read more about it <a href="https://www.repidemicsconsortium.org/aweek/">here</a></p>
</div>
</div>
<div id="general-syntax" class="section level2">
<h2>General Syntax</h2>
<p>A few things to remember when writing commands in R:</p>
<ul>
<li>Always close parentheses</li>
<li>Avoid spaces - in column and object names, etc. Use underscore ( _ ) or periods ( . ) instead</li>
<li>Keep track of and do not forget to separate a function’s arguments with commas</li>
<li>R is case-sensitive, meaning “Variable A” is <em>different</em> from “variable A”</li>
</ul>
</div>
<div id="errors-and-warnings" class="section level2">
<h2>Errors and Warnings</h2>
<p>When a command is run, the R Console may show you warning or error messages in red text.</p>
<ul>
<li><p>A <strong>warning</strong> means that R has completed your command, but had to take additional steps or produced unusual output that you should be aware of.</p></li>
<li><p>An <strong>error</strong> means that R was not able to complete your command.</p></li>
</ul>
</div>
